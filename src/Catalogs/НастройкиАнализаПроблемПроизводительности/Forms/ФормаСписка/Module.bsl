
&НаСервереБезКонтекста
Процедура УстановитьДанныеПодключенияНаСервере(ПараметрыНастроекПодключения, РезультатЗаписи)
	Попытка
		НачатьТранзакцию();
		Для Каждого ЭлементНастройки Из ПараметрыНастроекПодключения.МассивНастроек Цикл
			
			СправочникОбъект = ЭлементНастройки.ПолучитьОбъект();
			СправочникОбъект.АдресВебСервисаСистемыУчетаОшибок = ПараметрыНастроекПодключения.АдресВебСервисаСистемыУчетаОшибок;
			СправочникОбъект.Записать();
			
			УстановитьПривилегированныйРежим(Истина);
			ПараметрыАвторизации = Новый Структура("Логин, Пароль");
			ЗаполнитьЗначенияСвойств(ПараметрыАвторизации, ПараметрыНастроекПодключения);
			РегистрыСведений.БезопасноеХранилище.ЗаписатьДанные(ЭлементНастройки, ПараметрыАвторизации);
			УстановитьПривилегированныйРежим(Ложь);
			
		КонецЦикла;
		ЗафиксироватьТранзакцию();
	Исключение
		ОписаниеОшибки = ОписаниеОшибки;
		РезультатЗаписи = "Возникли ошибки при записи:
		|" + ОписаниеОшибки();
		ОтменитьТранзакцию();
	КонецПопытки;
КонецПроцедуры

&НаКлиенте
Процедура УстановитьДанныеПодключения(Команда)
	МассивНастроек = Элементы.Список.ВыделенныеСтроки;
	Если НЕ МассивНастроек.Количество() Тогда
		Возврат;
	КонецЕсли;
	ДополнительныеПараметры = Новый Структура("МассивНастроек", МассивНастроек);
	ОписаниеОповещенияОЗакрытии = Новый ОписаниеОповещения("УстановитьДанныеПодключенияПриЗакрытии", ЭтотОбъект, ДополнительныеПараметры);
	ОткрытьФорму("Справочник.НастройкиАнализаПроблемПроизводительности.Форма.УстановитьДанныеПодключения",,ЭтаФорма,,,,ОписаниеОповещенияОЗакрытии);	
КонецПроцедуры

&НаКлиенте
Процедура УстановитьДанныеПодключенияПриЗакрытии(РезультатЗакрытия, ДополнительныеПараметры) Экспорт
	Если РезультатЗакрытия = Неопределено Тогда
		Возврат;
	КонецЕсли;
	РезультатЗакрытия.Вставить("МассивНастроек", ДополнительныеПараметры.МассивНастроек);
	РезультатЗаписи = "Настройки подключения успешно установлены.";
	УстановитьДанныеПодключенияНаСервере(РезультатЗакрытия, РезультатЗаписи);
	Элементы.Список.Обновить();
	Сообщить(РезультатЗаписи);
КонецПроцедуры
